<!DOCTYPE html>
<html>
<head>
	<title>Picasso</title>
	<link rel = "stylesheet" href = "https://opensource.keycdn.com/fontawesome/4.7.0/font-awesome.min.css" type = "text/css" />
	<link rel = "stylesheet" href = "http://cdnjs.cloudflare.com/ajax/libs/bulma/0.3.1/css/bulma.min.css" type = "text/css" />
	<link rel = "stylesheet" href = "app.css" />
	<script src = "http://platform.twitter.com/widgets.js" async></script>
	<script src = "https://unpkg.com/vue"></script>
	<script src = "app.js" defer></script>
</head>
<body>
	<div id = "root">
		<!-- Upload Screen -->
		<transition name = "fade" appear>
			<div 
				id = "uploadScreen" 
				v-if = "screen == 'upload'" 
				key = "upload" 
				class = "hero is-fullheight is-light blur-overlay-container" 
				v-on:dragover.prevent = "activeBlur = true" 
				v-on:dragleave = "activeBlur = false" 
				v-on:drop.prevent = "activeBlur = false; onFolderDragged()" 
				:class = "{'blur-overlay': activeBlur}"
			>
				<div class = "hero-body">
					<div class = "container has-text-centered">
						<a v-on:click = "onIconPressed">
							<img src = "../icons/Icon_256x256.png">
						</a>
						<h5>{{helpLabel}}</h5>
						<h5>Currently supports: {{supportedFileTypes.join(", ").toUpperCase()}}</h5>
						<br/>
						<p>Need help or want to send feedback?</p>
						<br />
						<a href = "https://twitter.com/nexuist" class = "twitter-follow-button" data-size = "large" data-dnt = "true" data-show-count = "false">Follow @nexuist</a>
					</div>
				</div>
			</div>
		</transition>
		<!-- Main Screen -->
		<!-- tabindex is needed to make the keyboard shortcuts work correctly -->
		<transition name = "fade" appear>
			<div id = "mainScreen" v-if = "screen == 'main'" key = "main" 
			v-on:keyup.left = "modalShowing(null) && changeMedia(-1)" 
			v-on:keyup.a = "modalShowing(null) && changeMedia(-1)" 
			v-on:keyup.d = "modalShowing(null) && changeMedia(-1)" 
			v-on:keyup.right = "modalShowing(null) && changeMedia(1)" 
			v-on:keyup.space = "modalShowing(null) && toggleVideoPlaying()"
			v-on:keyup.x = "modalShowing('trash') ? trash() : (modalShowing(null) && setModal('trash'))"
			v-on:keyup.o = "modalShowing(null) && setModal('destinations')"
			v-on:keyup.q = "modalShowing(null) && setModal('destinations')"
			v-on:keyup.g = "modalShowing(null) && setModal('jump')"
			v-on:keyup.r = "modalShowing(null) && setModal('rename')"
			v-on:keyup.z = "modalShowing(null) && (imageZoomed = !imageZoomed)"
			v-on:keyup.numeric = "modalShowing('destinations') && destinations.length >= $event.key && moveToDestination(destinations[$event.key - 1])"
			v-on:keyup.esc = "setModal(null)"
			tabindex = "-1"
			>
				<!-- Image -->
				<img :class = "{ 'fitted': !imageZoomed, 'zoomed': imageZoomed }" v-if = "currentMedia && !currentMedia.isVideo" :src = "currentMedia.fileURL" onload = "root.toolbarEnabled = true" /> 
				<!-- Video -->
				<video controls autoplay loop :src = "currentMedia.fileURL" :class = "{ 'fitted': !imageZoomed, 'zoomed': imageZoomed }" v-if = "currentMedia && currentMedia.isVideo" v-on:canplay = "toolbarEnabled = true"></video>	
				<!-- Toolbar -->
				<nav class = "nav">
					<!-- Metadata -->
					<div class = "nav-left" v-if = "toolbarEnabled">
						<a class = "nav-item" v-on:click = "setModal('rename')">{{currentMedia.name}}.{{currentMedia.extension}}</a>
						<a class = "nav-item">{{currentMedia.width}}x{{currentMedia.height}}</a>
						<a class = "nav-item">{{currentMedia.size}}MB</a>
						<a class = "nav-item" v-on:click = "setModal('jump')">
							{{index + 1}}/{{media.length}}
						</a>
					</div>
					<div class = "nav-left" v-else>
						<a class = "nav-item"><i class="fa fa-circle-o-notch fa-spin fa-3x fa-fw"></i>  Scanning...</a>
					</div>
					Buttons
					<!-- is-active to keep visible on mobile -->
					<div class = "nav-right is-active">
						<span class = "nav-item">
							<btn icon = "external-link" v-on:click.native = "openExternal()" :disabled = "!toolbarEnabled"></btn>
							<btn icon = "search-plus" v-on:click.native = "imageZoomed = !imageZoomed" class = "is-warning" :solid = "imageZoomed" :disabled = "!toolbarEnabled"></btn>
							<btn icon = "folder" v-on:click.native = "setModal('destinations')" class = "is-primary" :disabled = "!toolbarEnabled"></btn>
							<btn icon = "trash" class = "is-danger" v-on:click.native = "setModal('trash')" :solid = "modalShowing('trash')" :disabled = "!toolbarEnabled"></btn>
							<btn icon = "chevron-circle-left" v-on:click.native = "changeMedia(-1)" :disabled = "!toolbarEnabled"></btn>
							<btn icon = "chevron-circle-right" v-on:click.native = "changeMedia(1)" :disabled = "!toolbarEnabled"></btn>
						</span>
					</div>
				</nav>
				<!-- Modals -->
				<modal :active = "modalShowing('trash')" name = "Delete Image">
					<div slot = "body">
						<p>Are you sure you want to delete '{{currentMedia && currentMedia.name}}'?</p>
					</div>
					<btn slot = "footer" icon = "trash" class = "is-danger" v-on:click.native = "trash()">
						<p slot = "text">Delete</p>
					</btn>
				</modal>
				<modal :active = "modalShowing('rename')" name = "Rename Image">
					<div slot = "body">
						<p class = "control has-addons">
							<input id = "rename" class = "input" type = "text" :value = "currentMedia && currentMedia.name" />
							<a class = "button">.{{currentMedia && currentMedia.extension }}</a>
						</p>
					</div>
					<btn slot = "footer" icon = "keyboard-o" class = "is-primary" v-on:click.native = "rename($event.target.ownerDocument.querySelector('input#rename').value); setModal(null);">
						<p slot = "text">Rename</p>
					</btn>
				</modal>
				<modal :active = "modalShowing('jump')" name = "Jump To Image">
					<div slot = "body">
						<input id = "jump" class = "input" type = "number" :min = "1" :max = "media.length" :class = "{ 'is-success': inputValid, 'is-danger': !inputValid }" :placeholder = "index + 1" v-on:change = "inputValid = $event.target.checkValidity()" />
					</div>
					<btn slot = "footer" class = "is-primary" :disabled = "!inputValid" v-on:click.native = "jump()">
						<p slot = "text">Jump</p>
					</btn>
				</modal>
				<modal :active = "modalShowing('destinations')" name = "Destinations">
					<div slot = "body">
						<aside class = "menu" v-if = "destinations.length > 0">
							<ul class="menu-list">
								<li v-for = "(folder, index) in destinations">
									<a v-on:click = "moveToDestination(folder)">
									<b v-if = "index < 10">{{index == 9 ? 0 : index + 1}}.</b> {{folder}} <span class = "delete is-pulled-right" v-on:click.stop = "destinations.splice(index, 1); saveSettings();"></span>
									</a>
								</li>
  						</ul>
						</aside>
						<p v-else>You have not set up any destinations for this folder yet.</p>
					</div>
					<btn slot = "footer" class = "is-primary" v-on:click.native = "addDestination()">
						<p slot = "text">Add Destination</p>
					</btn>
				</modal>
			</div>	
			</transition>
	</div>
</body>
</html>
