<!DOCTYPE html>
<html>
<head>
	<link rel = "stylesheet" href = "https://opensource.keycdn.com/fontawesome/4.7.0/font-awesome.min.css " type = "text/css" />
	<link rel = "stylesheet" href = "http://cdnjs.cloudflare.com/ajax/libs/bulma/0.3.1/css/bulma.min.css" type = "text/css" />
	<link rel = "stylesheet" href = "window.css" />
	<script src="https://unpkg.com/vue"></script>
	<script src = "window.js" defer></script>
</head>
<body>
	<div id = "root">
		<!-- Upload Screen -->
		<transition name = "fade" appear>
			<div class = "hero is-fullheight is-light" id = "uploadScreen" v-if = "screen == 'upload'" key = "upload">
				<div class = "hero-body">
					<div class = "container has-text-centered">
						<h1 class = "title">Drag in a folder.</h1>
						<a v-on:click = "chooseFolderPressed" class = "button is-dark is-outlined">
							<span class = "icon">
								<i class = "fa fa-folder-open"></i>
							</span>
							<span>Or, choose a folder</span>
						</a>
						<h5>{{uploadLabel}}</h5>
						<br/>
					</div>
				</div>
			</div>
		</transition>
		<!-- Main Screen -->
		<!-- tabindex is needed to make the keyboard shortcuts work correctly -->
		<transition name = "fade" appear>
			<div id = "mainScreen" v-if = "screen == 'main'" key = "main" 
			v-on:keyup.left = "modalShowing(null) && changeImage(-1)" 
			v-on:keyup.right = "modalShowing(null) && changeImage(1)" 
			v-on:keyup.space = "modalShowing(null) && toggleVideoPlaying()"
			v-on:keyup.x = "modalShowing('trash') ? trash() : (modalShowing(null) && setModal('trash'))"
			v-on:keyup.o = "modalShowing(null) && setModal('destinations')"
			v-on:keyup.g = "modalShowing(null) && setModal('jump')"
			v-on:keyup.r = "modalShowing(null) && setModal('rename')"
			v-on:keyup.z = "modalShowing(null) && (imageZoomed = !imageZoomed)"
			v-on:keyup.numeric = "modalShowing('destinations') && sortingFolders.length >= $event.key && moveToDestination(sortingFolders[$event.key - 1])"
			v-on:keyup.esc = "setModal(null)"
			tabindex = "-1"
			>
				<!-- Image -->
				<img :class = "{ 'fitted': !imageZoomed, 'zoomed': imageZoomed }" v-if = "currentImage && !currentImage.isVideo" :src = "currentImage.fileURL" onload = "root.toolbarEnabled = true" /> 
				<!-- Video -->
				<video controls autoplay :src = "currentImage.fileURL" :class = "{ 'fitted': !imageZoomed, 'zoomed': imageZoomed }" v-if = "currentImage && currentImage.isVideo" v-on:canplay = "toolbarEnabled = true"></video>	
				<!-- Toolbar -->
				<nav class = "nav">
					<!-- Metadata -->
					<div class = "nav-left" v-if = "toolbarEnabled">
						<a class = "nav-item" v-on:click = "setModal('rename')">{{currentImage.name}}.{{currentImage.extension}}</a>
						<a class = "nav-item">{{currentImage.width}}x{{currentImage.height}}</a>
						<a class = "nav-item">{{currentImage.size}}MB</a>
						<a class = "nav-item" v-on:click = "setModal('jump')">
							{{index + 1}}/{{images.length}}
						</a>
					</div>
					<div class = "nav-left" v-else>
						<a class = "nav-item"><i class="fa fa-circle-o-notch fa-spin fa-3x fa-fw"></i>  Scanning...</a>
					</div>
					<!-- Buttons -->
					<!-- is-active to keep visible on mobile -->
					<div class = "nav-right is-active">
						<span class = "nav-item">
							<btn icon = "external-link" v-on:click.native = "openExternal()" :disabled = "!toolbarEnabled"></btn>
							<btn icon = "search-plus" v-on:click.native = "imageZoomed = !imageZoomed" class = "is-warning" :solid = "imageZoomed" :disabled = "!toolbarEnabled"></btn>
							<btn icon = "folder" v-on:click.native = "setModal('destinations')" class = "is-primary" :disabled = "!toolbarEnabled"></btn>
							<btn icon = "trash" class = "is-danger" v-on:click.native = "setModal('trash')" :solid = "modalShowing('trash')" :disabled = "!toolbarEnabled"></btn>
							<btn icon = "chevron-circle-left" v-on:click.native = "changeImage(-1)" :disabled = "!toolbarEnabled"></btn>
							<btn icon = "chevron-circle-right" v-on:click.native = "changeImage(1)" :disabled = "!toolbarEnabled"></btn>
						</span>
					</div>
				</nav>
				<!-- Modals -->
				<modal :active = "modalShowing('trash')" name = "Delete Image">
					<div slot = "body">
						<p>Are you sure you want to delete '{{currentImage && currentImage.name}}'?</p>
					</div>
					<btn slot = "footer" icon = "trash" class = "is-danger" v-on:click.native = "trash()">
						<p slot = "text">Delete</p>
					</btn>
				</modal>
				<modal :active = "modalShowing('rename')" name = "Rename Image">
					<div slot = "body">
						<p class = "control has-addons">
							<input id = "rename" class = "input" type = "text" :value = "currentImage && currentImage.name" />
							<a class = "button">.{{currentImage && currentImage.extension }}</a>
						</p>
					</div>
					<btn slot = "footer" icon = "keyboard-o" class = "is-primary" v-on:click.native = "rename($event.target.ownerDocument.querySelector('input#rename').value); setModal(null);">
						<p slot = "text">Rename</p>
					</btn>
				</modal>
				<modal :active = "modalShowing('jump')" name = "Jump To Image">
					<div slot = "body">
						<input id = "jump" class = "input" type = "number" :min = "1" :max = "images.length" :class = "{ 'is-success': inputValid, 'is-danger': !inputValid }" :placeholder = "index + 1" v-on:change = "inputValid = $event.target.checkValidity()" />
					</div>
					<btn slot = "footer" class = "is-primary" :disabled = "!inputValid" v-on:click.native = "jump()">
						<p slot = "text">Jump</p>
					</btn>
				</modal>
				<modal :active = "modalShowing('destinations')" name = "Destinations">
					<div slot = "body">
						<aside class = "menu" v-if = "sortingFolders.length > 0">
							<ul class="menu-list">
								<li v-for = "(folder, index) in sortingFolders">
									<a v-on:click = "moveToDestination(folder)">
									<b v-if = "index < 10">{{index == 9 ? 0 : index + 1}}.</b> {{folder}} <span class = "delete is-pulled-right" v-on:click.stop = "sortingFolders.splice(index, 1); saveSettings();"></span>
									</a>
								</li>
  						</ul>
						</aside>
						<p v-else>You have not set up any destinations for this folder yet.</p>
					</div>
					<btn slot = "footer" class = "is-primary" v-on:click.native = "addDestination()">
						<p slot = "text">Add Destination</p>
					</btn>
				</modal>
			</div>
		</div>	
	</transition>
</div>
</body>
</html>
